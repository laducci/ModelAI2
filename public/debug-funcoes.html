<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>🔍 Debug Funções</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8">
    <h1 class="text-2xl mb-4">🔍 Debug - Verificação de Funções</h1>
    
    <div class="space-y-4">
        <button onclick="verificarFuncoes()" class="bg-blue-500 text-white px-4 py-2 rounded">
            Verificar Funções
        </button>
        
        <button onclick="testarModal()" class="bg-green-500 text-white px-4 py-2 rounded">
            Testar Modal
        </button>
        
        <button onclick="testarAPI()" class="bg-purple-500 text-white px-4 py-2 rounded">
            Testar API Usuários
        </button>
    </div>
    
    <div id="resultado" class="mt-6 p-4 bg-gray-100 rounded"></div>

    <!-- Modal simples para teste -->
    <div id="modalTeste" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-bold mb-4">🧪 Modal de Teste</h3>
            <p>Se você vê isso, o modal funciona!</p>
            <button onclick="fecharTeste()" class="mt-4 bg-red-500 text-white px-4 py-2 rounded">
                Fechar
            </button>
        </div>
    </div>

    <script src="js/usuarios.js"></script>
    <script>
        function log(msg) {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML += `<div>${msg}</div>`;
            console.log(msg);
        }

        function verificarFuncoes() {
            log('🔍 Verificando funções...');
            
            const funcoes = [
                'abrirModalNovoUsuario',
                'fecharModalNovoUsuario', 
                'criarUsuario',
                'carregarUsuarios'
            ];
            
            funcoes.forEach(nome => {
                if (typeof window[nome] === 'function') {
                    log(`✅ ${nome}: EXISTE`);
                } else {
                    log(`❌ ${nome}: NÃO EXISTE`);
                }
            });
        }

        function testarModal() {
            log('🧪 Testando modal...');
            try {
                if (typeof window.abrirModalNovoUsuario === 'function') {
                    window.abrirModalNovoUsuario();
                    log('✅ Função chamada com sucesso!');
                } else {
                    log('❌ Função não existe!');
                    // Teste com modal simples
                    document.getElementById('modalTeste').classList.remove('hidden');
                    log('🔧 Modal simples aberto para teste');
                }
            } catch (error) {
                log(`❌ Erro: ${error.message}`);
            }
        }

        function fecharTeste() {
            document.getElementById('modalTeste').classList.add('hidden');
            log('✅ Modal de teste fechado');
        }

        async function testarAPI() {
            log('📡 Testando API de usuários...');
            try {
                const response = await fetch('/api/users', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                log(`📊 Status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`✅ Usuários encontrados: ${data.users ? data.users.length : 0}`);
                    if (data.users) {
                        data.users.forEach(user => {
                            log(`👤 ${user.name} (${user.email}) - ${user.role}`);
                        });
                    }
                } else {
                    const error = await response.json();
                    log(`❌ Erro API: ${error.message}`);
                }
            } catch (error) {
                log(`❌ Erro de rede: ${error.message}`);
            }
        }

        // Auto-verificar quando carregar
        window.addEventListener('load', function() {
            setTimeout(verificarFuncoes, 1000);
        });
    </script>
</body>
</html>
